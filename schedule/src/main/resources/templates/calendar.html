<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>イベントカレンダー</title>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }

    .calendar-container {
      display: inline-block;
      margin-top: 20px;
    }

    table {
      border-collapse: collapse;
      width: 400px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      width: 14%;
      height: 60px;
      vertical-align: top;
    }

    th.sun {
      color: red;
      background-color: #ffeeee;
    }

    th.sat {
      color: blue;
      background-color: #eeeeff;
    }

    th {
      background-color: #f0f0f0;
    }

    td.highlight {
  position: relative;
  z-index: 0;
}

/* 外側にグラデーション枠を描く */
td.highlight::before {
  content: "";
  position: absolute;
  inset: -4px;              /* 枠の太さ */
  z-index: -1;
  border-radius: 4px;
  background: linear-gradient(135deg,
      #ff5252,
      #ffb347,
      #42a5f5,
      #ab47bc,
      #ff5252);
  background-size: 300% 300%;
  animation: borderFlow 4s linear infinite;
}

/* 内側のセル背景を白に戻す (はみ出し防止) */
td.highlight::after {
  content: "";
  position: absolute;
  inset: 0;
  background: #ffffff;
  z-index: -1;
}

/* 枠のグラデーションがゆっくり流れるアニメーション */
@keyframes borderFlow {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* 枠の光がゆっくり強弱するアニメーション */
@keyframes highlightPulse {
  from {
    box-shadow:
      inset 0 0 0 2px #ff6347,
      0 0 4px rgba(255, 99, 71, 0.4);
  }
  to {
    box-shadow:
      inset 0 0 0 2px #ff6347,
      0 0 16px rgba(255, 99, 71, 1);
  }
}


    .day-link {
      text-decoration: none;
      display: block;
      font-weight: bold;
      color: black;
    }

    .day-link:hover {
      background-color: #f0f8ff;
    }

    .nav-link {
      text-decoration: none;
      font-size: 18px;
      padding: 5px 15px;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
    }

    .nav-link:hover {
      background-color: #0056b3;
    }

    .current-month {
      font-size: 24px;
      margin: 0 20px;
      font-weight: bold;
    }

    .upload-section {
      margin-top: 40px;
      padding: 20px;
      border-top: 2px solid #ddd;
    }
  </style>
</head>

<body>

  <div class="calendar-container">
    <h2>カレンダー</h2>

    <div style="margin-bottom: 15px;">
      <a class="nav-link" th:href="@{/calendar(year=${prevYear}, month=${prevMonth})}">&lt; 前月</a>

      <span class="current-month">[[${targetYear}]]年 [[${targetMonth}]]月</span>

      <a class="nav-link" th:href="@{/calendar(year=${nextYear}, month=${nextMonth})}">次月 &gt;</a>
    </div>

    <table>
      <thead>
        <tr>
          <th class="sun">日</th>
          <th>月</th>
          <th>火</th>
          <th>水</th>
          <th>木</th>
          <th>金</th>
          <th class="sat">土</th>
        </tr>
      </thead>

      <tbody>
        <tr th:each="week : ${calendarMatrix}">
          <td th:each="day : ${week}"
            th:classappend="${day != null and highlightDays != null and highlightDays.contains(day)} ? ' highlight' : ''">
            <div th:if="${day != null}">
              <a class="day-link" th:href="@{/schedule/day(date=${targetYear} + '-' + ${targetMonth} + '-' + ${day})}">
                [[${day}]]
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <p><a href="/">トップへ戻る</a></p>
    <a href="/logout">ログアウト</a>
  </div>


  <!-- ★★★ 画像アップロードフォーム ★★★ -->
  <div class="upload-section">
    <h2>画像をアップロードのみ</h2>

    <form th:action="@{/upload}" th:method="post" enctype="multipart/form-data">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

      <div>
        <label>画像ファイル:</label>
        <input type="file" name="imageFile" accept="image/*" required>
      </div>

      <div>
        <label>指定日時:</label>
        <input type="datetime-local" name="scheduledTime" required>
      </div>

      <br>
      <button type="submit">アップロード</button>
    </form>

    <div th:if="${param.error}" style="color: red;">
      失敗しました。
    </div>
    <div th:if="${param.success}" style="color: green;">
      保存しました！
    </div>
  </div>

</body>

</html>
